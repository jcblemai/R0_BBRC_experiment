---
title: 'Planning Scenarios for COVID19 in Vaud'
#css: report.css
output:
  html_document:
  df_print: paged
pdf_document: default
word_document: default
params:
#bibliography: ReportReferences.bib
---
  
```{r setup, echo = F, message=F, warning = F}
options(scipen=999)
#knitr::opts_chunk$set(echo = F, message=F, warning = F)
knitr::opts_knit$set(root.dir = '../')

library(tidyverse)
library(magrittr)
library(knitr)
library(kableExtra)
library(gridExtra)
library(foreach)
library(doSNOW)

library(magrittr)
library(foreach)
library(itertools)
library(lubridate)
library(sf)
library(glue)
select <- dplyr::select
source("COVID-pomp/scripts/graph_utils.R")
```

```{r load data}
# Load data that has been produced
geodata <- read.csv("data/ch/geodata.csv")
files_filter <- list.files(path = "COVID-pomp/results/", pattern = "filtered_*")
cantons <- lapply(files_filter, function(s) unlist(strsplit(s, '_'))[3])
col_id <- 'ShortName'
country <- st_read("data/ch/shp/swissBOUNDARIES3D_1_3_TLM_KANTONSGEBIET.shp")

for (i in seq(nrow(country))) {
  country$ShortName[i] <- lapply(geodata[col_id][geodata$CantonNumber == country$KANTONSNUM[i],], as.character) # TODO hardcoded
}

for (ctn in cantons) {
  print(str_c('Loading...', ctn))
  ffilter <- list.files(path = "COVID-pomp/results/", pattern = glue("filtered_covid_{ctn}_*"))
  load(glue("COVID-pomp/results/{ffilter}"))
}
```


```{r show map}
ffilter <- list.files(path = "COVID-pomp/results/", pattern = glue("filtered_covid_*"), full.names = TRUE)

data <- ffilter %>%
  map(readRDS) %>%    # read in all the files individually, using
  reduce(rbind)        # reduce with rbind into one dataframe
data
```


```{r show map}
country_R0 <-  inner_join(country, final_dat_unc_Sept, by=col_id)
```

